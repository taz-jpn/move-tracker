# ゲーム性追加の提案

## 概要

MoveTrackerにゲーム要素を追加し、移動のモチベーションを高める。

---

## 1. 軌跡ラインの削除

### 現状の問題
- GPSの精度問題でジグザグになる
- 見た目が悪く、ユーザー体験を損ねる

### 提案
- 軌跡のポリライン描画を削除
- 代わりに現在位置マーカーのみ表示
- 移動距離・時間は数値で表示（現状通り）

### 実装難易度
⭐ 簡単（コード削除のみ）

---

## 2. ドット収集システム

### 概要
地図上にドット（コイン/オーブ）を配置し、近づくと収集できる。

### 仕様案

#### ドットの配置方法
| 方法 | メリット | デメリット |
|------|----------|------------|
| **A: 現在地周辺にランダム生成** | シンプル | 道路外や建物内に出る可能性 |
| **B: 移動経路の先に生成** | 自然な配置 | 移動方向の予測が必要 |
| **C: グリッド配置** | 均等で公平 | 機械的で面白みに欠ける |

**推奨: A（ランダム生成）** - まずシンプルに実装し、後で改善

#### ドットの種類
| 種類 | 出現率 | スコア | 色 |
|------|--------|--------|-----|
| ノーマル | 80% | +10 | 黄色 |
| シルバー | 15% | +30 | 銀色 |
| ゴールド | 5% | +100 | 金色 |

#### 収集条件
- 半径 15m 以内に近づくと自動収集
- 効果音とアニメーション表示
- **速度制限**: 徒歩・自転車のみ収集可能（車での収集は不可）

#### ドットの生成ルール
- トラッキング開始時に現在地周辺に 10-20個 生成
- 一定距離（例: 100m）移動するたびに進行方向に追加生成
- 画面外のドットは一定時間後に消滅（メモリ節約）

#### データ永続化
- 収集済みドットはセッションに紐づけて保存
- セッション終了時に収集数をスコアに加算

### 実装難易度
⭐⭐⭐ 中程度（マーカー管理、距離判定、状態管理が必要）

---

## 3. 達成メダルシステム

### 概要
特定の条件を達成するとメダル（バッジ）を獲得。コレクション要素。

### メダル案

#### 距離系
| メダル名 | 条件 | アイコン案 |
|----------|------|------------|
| ファーストステップ | 累計 1km 達成 | 👟 |
| ウォーカー | 累計 10km 達成 | 🚶 |
| マラソナー | 累計 42.195km 達成 | 🏃 |
| 100kmクラブ | 累計 100km 達成 | 🎖️ |

#### 継続系
| メダル名 | 条件 | アイコン案 |
|----------|------|------------|
| 3日連続 | 3日連続で記録 | 🔥 |
| 週間チャンピオン | 7日連続で記録 | 🏆 |
| 月間マスター | 30日連続で記録 | 👑 |

#### スコア系
| メダル名 | 条件 | アイコン案 |
|----------|------|------------|
| ルーキー | 累計 100pt | ⭐ |
| エキスパート | 累計 1,000pt | ⭐⭐ |
| マスター | 累計 10,000pt | ⭐⭐⭐ |

#### ドット収集系（ドット機能実装後）
| メダル名 | 条件 | アイコン案 |
|----------|------|------------|
| コレクター | 100個収集 | 🟡 |
| ハンター | 1,000個収集 | 🟠 |
| ゴールドラッシュ | ゴールドドット10個収集 | 🥇 |

#### 特殊系
| メダル名 | 条件 | アイコン案 |
|----------|------|------------|
| 早起き | 朝6時前に記録開始 | 🌅 |
| ナイトウォーカー | 夜10時以降に記録 | 🌙 |
| 雨の日ウォーカー | 雨の日に記録（天気API連携） | ☔ |

### UI案
- スコア画面にメダル一覧セクションを追加
- 未取得メダルはグレーアウト表示
- 取得時にポップアップ通知

### 実装難易度
⭐⭐ 簡単〜中程度（条件判定とUI追加）

---

## 実装優先度の提案

| 優先度 | 機能 | 理由 |
|--------|------|------|
| 1 | 軌跡ライン削除 | 簡単＆即効果あり |
| 2 | 達成メダル（基本） | 既存データで実装可能 |
| 3 | ドット収集 | 新規機能だが効果大 |
| 4 | メダル追加 | ドット収集後に拡張 |

---

## 技術的な考慮事項

### ドット収集
- flutter_map の Marker で表示
- 位置更新のたびに全ドットとの距離を計算
- パフォーマンス: 画面内のドットのみ距離計算（最適化）

### メダル
- 新規テーブル `medals` を追加
- 条件判定は `stopSession()` 時に実行
- 取得済みメダルは `user_medals` テーブルで管理

### データモデル案

```dart
// ドット
class CollectibleDot {
  final String id;
  final LatLng position;
  final DotType type; // normal, silver, gold
  final DateTime createdAt;
  bool collected;
}

// メダル定義
class Medal {
  final String id;
  final String name;
  final String description;
  final String icon;
  final MedalCondition condition;
}

// ユーザーのメダル取得状況
class UserMedal {
  final String odId;
  final String odId;
  final DateTime earnedAt;
}
```

---

## 次のステップ

1. この提案についてフィードバックをください
2. 優先度を決定
3. 詳細設計→実装
